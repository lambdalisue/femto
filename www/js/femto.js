shortcut={all_shortcuts:{},add:function(a,b,c){var d={type:"keydown",propagate:!1,disable_in_input:!1,target:document,keycode:!1};if(!c)c=d;else for(var e in d)typeof c[e]=="undefined"&&(c[e]=d[e]);var f=c.target;typeof c.target=="string"&&(f=document.getElementById(c.target));var g=this;a=a.toLowerCase();var h=function(d){d=d||window.event;if(c.disable_in_input){var e;d.target?e=d.target:d.srcElement&&(e=d.srcElement),e.nodeType==3&&(e=e.parentNode);if(e.tagName=="INPUT"||e.tagName=="TEXTAREA")return}d.keyCode?code=d.keyCode:d.which&&(code=d.which);var f=String.fromCharCode(code).toLowerCase();code==188&&(f=","),code==190&&(f=".");var g=a.split("+"),h=0,i={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},j={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},l={shift:{wanted:!1,pressed:!1},ctrl:{wanted:!1,pressed:!1},alt:{wanted:!1,pressed:!1},meta:{wanted:!1,pressed:!1}};d.ctrlKey&&(l.ctrl.pressed=!0),d.shiftKey&&(l.shift.pressed=!0),d.altKey&&(l.alt.pressed=!0),d.metaKey&&(l.meta.pressed=!0);for(var m=0;k=g[m],m<g.length;m++)k=="ctrl"||k=="control"?(h++,l.ctrl.wanted=!0):k=="shift"?(h++,l.shift.wanted=!0):k=="alt"?(h++,l.alt.wanted=!0):k=="meta"?(h++,l.meta.wanted=!0):k.length>1?j[k]==code&&h++:c.keycode?c["keycode"]==code&&h++:f==k?h++:i[f]&&d.shiftKey&&(f=i[f],f==k&&h++);if(h==g.length&&l.ctrl.pressed==l.ctrl.wanted&&l.shift.pressed==l.shift.wanted&&l.alt.pressed==l.alt.wanted&&l.meta.pressed==l.meta.wanted){b(d);if(!c.propagate)return d.cancelBubble=!0,d.returnValue=!1,d.stopPropagation&&(d.stopPropagation(),d.preventDefault()),!1}};this.all_shortcuts[a]={callback:h,target:f,event:c.type},f.addEventListener?f.addEventListener(c.type,h,!1):f.attachEvent?f.attachEvent("on"+c.type,h):f["on"+c.type]=h},remove:function(a){a=a.toLowerCase();var b=this.all_shortcuts[a];delete this.all_shortcuts[a];if(!b)return;var c=b.event,d=b.target,e=b.callback;d.detachEvent?d.detachEvent("on"+c,e):d.removeEventListener?d.removeEventListener(c,e,!1):d["on"+c]=!1}},function(){var a=[].slice;window.namespace=function(b,c,d){var e,f,g,h,i,j;arguments.length<3&&(i=[typeof exports!="undefined"?exports:window].concat(a.call(arguments)),b=i[0],c=i[1],d=i[2]),f=b,j=c.split(".");for(g=0,h=j.length;g<h;g++)e=j[g],b=b[e]||(b[e]={});return d(b,f)}}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t={}.hasOwnProperty,u=function(a,b){function d(){this.constructor=a}for(var c in b)t.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},v=function(a,b){return function(){return a.apply(b,arguments)}};m=function(){function a(a){this.textarea=a,this}return a.prototype._getCaret=function(){var a,b;return b=this.textarea.selectionStart,a=this.textarea.selectionEnd,[b,a]},a.prototype._setCaret=function(a,b){return this.textarea.setSelectionRange(a,b),this},a.prototype._getWholeText=function(){return this.textarea.value},a.prototype._setWholeText=function(a){return this.textarea.value=a,this},a.prototype._replace=function(a,b,c){var d,e,f;return f=this._getWholeText(),e=f.substring(0,b),d=f.substring(c),this._setWholeText(e+a+d)},a.prototype.caret=function(a,b){var c,d;return a==null?this._getCaret():b==null?(c=this._getCaret(),this.caret(c[0]+a,c[1]+a)):(d=this.textarea.scrollTop,this._setCaret(a,b),this.textarea.scrollTop=d,this)},a.prototype.isCollapsed=function(){var a,b,c;return c=this._getCaret(),b=c[0],a=c[1],b===a},a.prototype.collapse=function(a){var b,c,d;return d=this._getCaret(),c=d[0],b=d[1],a?this._setCaret(c,c):this._setCaret(b,b),this},a.prototype.text=function(a,b){var c,d,e,f;return f=this._getCaret(),d=f[0],c=f[1],a==null?this._getWholeText().substring(d,c):(e=this.textarea.scrollTop,this._replace(a,d,c),c=d+a.length,b||(d=c),this._setCaret(d,c),this.textarea.scrollTop=e,this)},a.prototype.lineCaret=function(a,b){var c,d,e,f;if(a==null||b==null)f=this._getCaret(),d=f[0],c=f[1],a=a!=null?a:d,b=b!=null?b:c;return e=this._getWholeText(),a=e.lastIndexOf("\n",a-1)+1,b=e.indexOf("\n",b),b===-1&&(b=e.length),[a,b]},a.prototype.lineText=function(a,b){var c,d,e,f;return f=this.lineCaret(),d=f[0],c=f[1],a==null?this._getWholeText().substring(d,c):(e=this.textarea.scrollTop,this._replace(a,d,c),c=d+a.length,b||(d=c),this._setCaret(d,c),this.textarea.scrollTop=e,this)},a.prototype.insertBefore=function(a,b){var c,d,e,f,g;return g=this._getCaret(),d=g[0],c=g[1],f=this.text(),e=this.textarea.scrollTop,this._replace(a+f,d,c),c=d+a.length,b||(d=c),this._setCaret(d,c),this.textarea.scrollTop=e,this},a.prototype.insertAfter=function(a,b){var c,d,e,f,g;return g=this._getCaret(),d=g[0],c=g[1],f=this.text(),e=this.textarea.scrollTop,this._replace(f+a,d,c),d=c,c+=a.length,b||(d=c),this._setCaret(d,c),this.textarea.scrollTop=e,this},a.prototype.enclose=function(a,b,c){var d,e,f,g,h,i,j;return i=this.text(),g=this.textarea.scrollTop,e=i.lastIndexOf(b),i.indexOf(a)===0&&e===i.length-b.length?(h=i.substring(a.length,i.length-b.length),this.text(h,c)):(j=this._getCaret(),f=j[0],d=j[1],this._replace(a+i+b,f,d),d=f+a.length+i.length+b.length,c||(f=d),this._setCaret(f,d)),this.textarea.scrollTop=g,this},a.prototype.insertBeforeLine=function(a,b){var c,d,e,f,g;return g=this.lineCaret(),d=g[0],c=g[1],f=this.lineText(),e=this.textarea.scrollTop,this._replace(a+f,d,c),c=d+a.length,b||(d=c),this._setCaret(d,c),this.textarea.scrollTop=e,this},a.prototype.insertAfterLine=function(a,b){var c,d,e,f,g;return g=this.lineCaret(),d=g[0],c=g[1],f=this.lineText(),e=this.textarea.scrollTop,this._replace(f+a,d,c),d=c,c+=a.length,b||(d=c),this._setCaret(d,c),this.textarea.scrollTop=e,this},a.prototype.encloseLine=function(a,b,c){var d,e,f,g,h,i,j;return i=this.lineText(),g=this.textarea.scrollTop,e=i.lastIndexOf(b),i.indexOf(a)===0&&e===i.length-b.length?(h=i.substring(a.length,i.length-b.length),this.text(h,c)):(j=this.lineCaret(),f=j[0],d=j[1],this._replace(a+i+b,f,d),d=f+a.length+i.length+b.length,c||(f=d),this._setCaret(f,d)),this.textarea.scrollTop=g,this},a}(),namespace("Femto.utils",function(a){return a.W3CSelection=m,a.Selection=m}),document.selection!=null&&(g=function(a){function b(a){this.textarea=a,this._document=this.textarea.ownerDocument}return u(b,a),b.prototype._getWholeText=function(){return this.textarea.value.replace(/\r/g,"")},b.prototype._getCaret=function(){var a,b,c,d,e,f,g;return e=a=0,f=this.textarea,d=this._document.selection.createRange(),d&&d.parentElement()===f&&(c=f.value.replace(/\r/g,"").length,g=f.createTextRange(),g.moveToBookmark(d.getBookmark()),b=f.createTextRange(),b.collapse(!1),g.compareEndPoints("StartToEnd",b)>-1?e=a=c:(e=-g.moveStart("character",-c),g.compareEndPoints("EndToEnd",b)>-1?a=c:a=-g.moveEnd("character",-c))),[e,a]},b.prototype._setCaret=function(a,b){var c;return c=this.textarea.createTextRange(),c.collapse(!0),c.moveStart("character",a),c.moveEnd("character",b-a),c.select(),this},b}(Femto.utils.W3CSelection),namespace("Femto.utils",function(a){return a.IESelection=g,a.Selection=g})),c=function(a){var b;return a.css("position")==="static"&&a.css("position","relative"),b=$("<div>").appendTo(a).hide().css({position:"absolute",top:0,left:0,overflow:"hidden","z-index":1e4,width:"100%",height:"100%"}),b.adjust=function(){return this.width(a.outerWidth(!0)),this.height(height.outerHeight(!0)),this},b.show=function(){return this.adjust(),jQuery.prototype.show.apply(this,arguments),this},b},namespace("Femto.utils",function(a){return a.Curtain=c}),j=function(){function a(){}return a.prototype.createMemento=function(){throw Error("Not implemented yet")},a.prototype.setMemento=function(a){throw Error("Not implemented yet")},a}(),b=function(){function a(a){this._originator=a,this._undoStack=[],this._redoStack=[],this._previous=null}return a.prototype.originator=function(a){return a!=null?(this._originator=a,this):this._originator},a.prototype.save=function(a){a=a||this.originator().createMemento();if(this._previous==null||this._previous!==a)this._undoStack.push(a),this._redoStack=[],this._previous=a;return this},a.prototype.undo=function(){var a;return this.canUndo()?(a=this.originator(),this._redoStack.push(a.createMemento()),a.setMemento(this._undoStack.pop()),this):this},a.prototype.redo=function(){var a;return this.canRedo()?(a=this.originator(),this._undoStack.push(a.createMemento()),a.setMemento(this._redoStack.pop()),this):this},a.prototype.canUndo=function(){return this._undoStack.length>0},a.prototype.canRedo=function(){return this._redoStack.length>0},a}(),typeof exports!="undefined"&&exports!==null&&(exports.Originator=j,exports.Caretaker=b),typeof namespace!="undefined"&&namespace!==null&&namespace("Femto.utils",function(a){return a.Originator=j,a.Caretaker=b}),s=function(a){var b,c,d,e,f,g;if(a===void 0||a===null)return String(a);b=new Object,g="Boolean Number String Function Array Date RegExp".split(" ");for(e=0,f=g.length;e<f;e++)d=g[e],b["[object "+d+"]"]=d.toLowerCase();return c=Object.prototype.toString.call(a),c in b?b[c]:"object"},namespace("Femto.utils",function(a){return a.type=s}),n=function(a,b){var c,d,e;return a==null&&(a="<div>"),a instanceof jQuery?c=a:c=$(a,b),e=jQuery.prototype.outerWidth,d=jQuery.prototype.outerHeight,c.nonContentWidth=function(a){return a==null&&(a=!1),e.call(this,a)-this.width()},c.nonContentHeight=function(a){return a==null&&(a=!1),d.call(this,a)-this.height()},c.outerWidth=function(a,b){var c;return Femto.utils.type(a)==="number"&&(b=a,a=!1),b==null?e.call(this):(c=this.nonContentWidth(a),this.width(b-c))},c._outerHeight=c.outerHeight,c.outerHeight=function(a,b){var c;return Femto.utils.type(a)==="number"&&(b=a,a=!1),b==null?d.call(this):(c=this.nonContentHeight(a),this.height(b-c))},c.widget=!0,c},namespace("Femto.widget",function(a){return a.Widget=n}),e=function(a,b){var c,d,e,f,g;g=jQuery("<select>"),c=Femto.widget.Widget(),c.addClass("documentType"),c.append(g),c.select=g;for(e in b)d=b[e],f="<option value='"+e+"'>"+e+"</option>",g.append(jQuery(f));return g.change(function(){return d=b[g.val()],a.parser=d}),g.change(),c},namespace("Femto.widget",function(a){return a.DocumentType=e}),h=function(){var a,b,c;return c=a=null,b=Femto.widget.Widget("<iframe>"),b.css({margin:0,padding:0,border:"none",outline:"none",resize:"none",overflow:"scroll",width:"100%",height:"100%"}),b.attr("frameborder",0),b.focus=function(){return c.contentWindow.focus(),this},b.blur=function(){return c.contentWindow.document.body.blur(),this},b.init=function(){var b;return c=this.get(0),c.contentDocument!=null?a=c.contentDocument:a=c.contentWindow.document,a.write("<body></body>"),b=a.body.style,b.margin="0",b.padding="0",b.width="100%",b.height="100%",this.document=a,this},b.write=function(b){var c;if(a!=null){try{c=a.documentElement.scrollTop}catch(d){c=0}a.open(),a.write(b),a.close(),$(a).find("a").attr("target","_blank"),a.documentElement.scrollTop=c}return this},b},namespace("Femto.widget",function(a){return a.IFrame=h}),f=function(a){var b,c;return c=a.get(0),a=Femto.widget.Widget(a),a.css({margin:"0",padding:"0",border:"none",outline:"none",resize:"none",width:"100%",height:"100%"}),a.setMemento=a.val,a.createMemento=a.val,a._caretaker=new Femto.utils.Caretaker(a),a._caretaker.save(),a._selection=new Femto.utils.Selection(c),b=Femto.widget.Widget(),b.addClass("panel").addClass("editor"),b.append(a),b.textarea=a,b.selection=a._selection,b.caretaker=a._caretaker,b.focus=function(){return a.focus(),this},b.val=function(){return a.val.apply(a,arguments)},a.on("keydown",function(b){var c;((c=b.which)===13||c===9||c===8||c===46)&&a._caretaker.save();if(b.which===90&&b.ctrlKey)return b.shiftKey?a._caretaker.redo():a._caretaker.undo(),b.stopPropagation(),b.stopImmediatePropagation(),b.preventDefault(),!1}),a.on("paste,drop",function(b){return a._caretaker.save()}),b},namespace("Femto.widget",function(a){return a.Editor=f}),l=function(a,b){var c,d;return d=Femto.widget.IFrame(),c=Femto.widget.Widget(),c.addClass("panel").addClass("viewer"),c.append(d),c.iframe=d,c.textarea=a,c.template=b,c.curtain=Femto.utils.Curtain(c),c.parser=null,c.init=function(){return d.init(),this},c.focus=function(){return d.focus(),this},c.blur=function(){return d.blur(),this},c.val=function(a){var b,c=this;return b=function(a){return c.template.render(a,function(a){return c.iframe.write(a)})},this.parser!=null?b(this.parser(a)):b(a),this},c},namespace("Femto.widget",function(a){return a.Viewer=l}),a=function(){function a(a,b,c){var d;this.textarea=a,this.expandTab=b!=null?b:!0,this.indentLevel=c!=null?c:4,this._keyDownEvent=v(this._keyDownEvent,this),this.textarea instanceof jQuery||(this.textarea=jQuery(this.textarea)),this.textarea._selection!=null?this._selection=this.textarea._selection:(this._selection=new Femto.utils.Selection(this.textarea.get(0)),this.textarea._selection=this._selection),this.expandTab?d=Femto.utils.Indenty._makeTabString(this.indentLevel):d="\t",this._pattern=new RegExp("^(?:"+d+")*")}return a.prototype.insertNewLine=function(){var a,b,c,d,e,f,g;return g=this._selection.caret(),e=g[0],a=g[1],f=this._selection._getWholeText(),d=f.lastIndexOf("\n",a-1)+1,b=f.slice(d,a).match(this._pattern),c="\n"+b,this._selection.insertAfter(c,!1),e===a?this._selection.caret(e+c.length,e+c.length):this._selection.caret(e,a+c.length),this},a.prototype._keyDownEvent=function(a){var b,c;return b=13,a.which!==b?!0:a.shiftKey?!0:(this.insertNewLine(),(c=this.textarea._caretaker)!=null&&c.save(),a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault(),!1)},a.prototype.enable=function(){var a=this;return this.textarea.on("keydown",function(b){return a._keyDownEvent(b)})},a.prototype.disable=function(){var a=this;return this.textarea.off("keydown",function(b){return a._keyDownEvent(b)})},a}(),namespace("Femto.utils",function(b){return b.AutoIndenty=a}),d="<html><head>\n  <style>\n    body { color: #333; }\n  </style>\n</head><body>\n  <!--CONTENT-->\n</body></html>",k=function(){function a(a,b){this.template=a!=null?a:null,this.templateURI=b!=null?b:null}return a.prototype.load=function(a,b,c){var d,e=this;d=function(a){e.template=a;if(b!=null)return dane(a)};if(this.templateURI!==a||this.template==null||c)this.templateURI=a,jQuery.ajax({url:a,success:d});return this},a.prototype.render=function(a,b){var c,e=this;return c=function(c){return b(c.replace(/<!--CONTENT-->/g,a)),e},this.template==null&&this.templateURI!=null?this.load(this.templateURI,c,!0):this.template==null&&(this.template=d),c(this.template)},a}(),namespace("Femto.utils",function(a){return a.Template=k}),i=function(){function a(a,b,c){this.textarea=a,this.expandTab=b!=null?b:!0,this.indentLevel=c!=null?c:4,this._keyDownEvent=v(this._keyDownEvent,this),this.textarea instanceof jQuery||(this.textarea=jQuery(this.textarea)),this.textarea._selection!=null?this._selection=this.textarea._selection:(this._selection=new Femto.utils.Selection(this.textarea.get(0)),this.textarea._selection=this._selection)}return a.prototype.indent=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,r,s=this;return b=this._selection.isCollapsed(),m=this._selection.text(),p=this._selection.caret(),c=p[0],a=p[1],r=this._selection.lineCaret(),h=r[0],g=r[1],!b&&m.indexOf("\n")!==-1?(e=function(a){var b,c,d;return s.expandTab?(c=a.length-a.replace(/^\s*/,"").length,b=c%s.indentLevel,d=q(s.indentLevel-b)):d="\t",d+a},m=this._selection.lineText().split("\n"),i=function(){var a,b,c;c=[];for(a=0,b=m.length;a<b;a++)f=m[a],c.push(e(f));return c}(),this._selection.lineText(i.join("\n"),!1),k=i[0].length-m[0].length,j=i.join("").length-m.join("").length,h!==c&&(c+=k),this._selection.caret(c,a+j)):(this.expandTab?(l=c-h,d=l%this.indentLevel,o=q(this.indentLevel-d)):o="\t",n=o.length,this._selection.text(o+m,!1),this._selection.caret(c+n,a+n)),this},a.prototype.outdent=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,r,s,t,u,v,w,x=this;d=this._selection.isCollapsed(),s=this._selection.text(),k=this._selection.lineText(),v=this._selection.caret(),e=v[0],c=v[1],w=this._selection.lineCaret(),l=w[0],i=w[1];if(!d&&s.indexOf("\n")!==-1)p=function(a){var b,c,d;return x.expandTab?(c=a.length-a.replace(/^\s*/,"").length,b=c%x.indentLevel,d=q(x.indentLevel-b)):d="\t",a.replace(new RegExp("^"+d),"")},s=this._selection.lineText().split("\n"),m=function(){var a,b,c;c=[];for(a=0,b=s.length;a<b;a++)h=s[a],c.push(p(h));return c}(),this._selection.lineText(m.join("\n"),!1),o=s[0].length-m[0].length,n=s.join("").length-m.join("").length,l!==e&&(e-=o),this._selection.caret(e,c-n);else{this.expandTab?(j=s.length-s.replace(/^\s*/,"").length,r=e-l+j,f=r%this.indentLevel,u=q(this.indentLevel-f)):u="\t",t=u.length,g=k.lastIndexOf(u,e-l);if(g===-1)return this;b=k.substring(0,g),a=k.substring(g+u.length),this._selection.lineText(b+a,!1),this._selection.caret(e-t,c-t)}return this},a.prototype._keyDownEvent=function(a){var b;if(a.which!==9)return;return a.shiftKey?this.outdent():this.indent(),(b=this.textarea._caretaker)!=null&&b.save(),a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault(),!1},a.prototype.enable=function(){return this.textarea.on("keydown",this._keyDownEvent),this},a.prototype.disable=function(){return this.textarea.off("keydown",this._keyDownEvent),this},a}(),i._makeTabString=q=function(a){var b;return b=""+a+"Cache",q[b]==null&&(q[b]=(new Array(a+1)).join(" ")),q[b]},namespace("Femto.utils",function(a){return a.Indenty=i}),o=function(a){var b;return b=a.editor.textarea,a.features.autoIndent=new Femto.utils.AutoIndenty(b),a.features.autoIndent.enable()},namespace("Femto.features",function(a){return a.autoIndent=o}),p=function(a){var b;return b=a.editor.textarea,a.features.indent=new Femto.utils.Indenty(b),a.features.indent.enable()},namespace("Femto.features",function(a){return a.indent=p}),r=function(a,b){var c,d,e,f,g,h;b=jQuery.extend({template:new Femto.utils.Template,previewModeShortcut:"Shift+Right",editingModeShortcut:"Shift+Left",documentTypes:null},b),e=Femto.widget.Widget($("<div>").insertAfter(a).hide()).addClass("femto"),e.editor=Femto.widget.Editor(a),e.viewer=Femto.widget.Viewer(a,b.template),e.caretaker=e.editor.caretaker,e.append(e.editor),e.append(e.viewer),b.documentTypes!==null&&(e.documentType=Femto.widget.DocumentType(e.viewer,b.documentTypes),e.editor.append(e.documentType)),e.init=function(){var a,c,d;return typeof (a=this.editor).init=="function"&&a.init(),typeof (c=this.viewer).init=="function"&&c.init(),(d=this.documentType)!=null&&typeof d.init=="function"&&d.init(),b.previewModeShortcut&&shortcut.add(b.previewModeShortcut,e.previewMode,{target:document}),b.editingModeShortcut&&shortcut.add(b.editingModeShortcut,e.editingMode,{target:e.viewer.iframe.document}),this.editingMode(!1,!1),this.show(),this},d=c=0,e.previewMode=function(){var a;return a=e.editor.selection.caret(),d=a[0],c=a[1],e.viewer.val(e.editor.val()),e.viewer.focus(),b.editingModeShortcut&&shortcut.add(b.editingModeShortcut,e.editingMode,{target:e.viewer.iframe.document}),e.editor.removeClass("active"),e.viewer.addClass("active")},e.editingMode=function(a,b){a==null&&(a=!0),b==null&&(b=!0),e.editor.addClass("active"),e.viewer.removeClass("active"),a&&(window.top.focus(),e.editor.focus());if(b)return e.editor.selection.caret(d,c)},e.features={},h=Femto.features;for(g in h)f=h[g],f(e);return jQuery(e).ready(function(){return e.init()}),e},namespace("Femto",function(a){return a.transform=r})}.call(this)