var utils={};((function(){"use strict";var a,b,c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};utils.Selection=function(){function a(a){this.textarea=a,this}return a.prototype._getCaret=function(){var a,b;return b=this.textarea.selectionStart,a=this.textarea.selectionEnd,[b,a]},a.prototype._setCaret=function(a,b){return this.textarea.setSelectionRange(a,b),this},a.prototype._getWholeText=function(){return this.textarea.value},a.prototype._setWholeText=function(a){return this.textarea.value=a,this},a.prototype._replace=function(a,b,c){var d,e,f;return f=this._getWholeText(),e=f.substring(0,b),d=f.substring(c),this._setWholeText(e+a+d)},a.prototype.caret=function(a,b){var c,d;return a==null?this._getCaret():b==null?(c=this._getCaret(),this.caret(c[0]+a,c[1]+a)):(d=this.textarea.scrollTop,this._setCaret(a,b),this.textarea.scrollTop=d,this)},a.prototype.text=function(a,b){var c,d,e,f;return f=this._getCaret(),d=f[0],c=f[1],a==null?this._getWholeText().substring(d,c):(e=this.textarea.scrollTop,this._replace(a,d,c),c=d+a.length,b||(d=c),this._setCaret(d,c),this.textarea.scrollTop=e,this)},a.prototype.lineCaret=function(a,b){var c,d,e,f;if(a==null||b==null)f=this._getCaret(),d=f[0],c=f[1],a=a!=null?a:d,b=b!=null?b:c;return e=this._getWholeText(),a=e.lastIndexOf("\n",a-1)+1,b=e.indexOf("\n",b),b===-1&&(b=e.length),[a,b]},a.prototype.lineText=function(a,b){var c,d,e,f;return f=this.lineCaret(),d=f[0],c=f[1],a==null?this._getWholeText().substring(d,c):(e=this.textarea.scrollTop,this._replace(a,d,c),c=d+a.length,b||(d=c),this._setCaret(d,c),this.textarea.scrollTop=e,this)},a.prototype.insertBefore=function(a,b){var c,d,e,f,g;return g=this._getCaret(),d=g[0],c=g[1],f=this.text(),e=this.textarea.scrollTop,this._replace(a+f,d,c),c=d+a.length,b||(d=c),this._setCaret(d,c),this.textarea.scrollTop=e,this},a.prototype.insertAfter=function(a,b){var c,d,e,f,g;return g=this._getCaret(),d=g[0],c=g[1],f=this.text(),e=this.textarea.scrollTop,this._replace(f+a,d,c),d=c,c+=a.length,b||(d=c),this._setCaret(d,c),this.textarea.scrollTop=e,this},a.prototype.enclose=function(a,b,c){var d,e,f,g,h,i,j;return i=this.text(),g=this.textarea.scrollTop,e=i.lastIndexOf(b),i.indexOf(a)===0&&e===i.length-b.length?(h=i.substring(a.length,i.length-b.length),this.text(h,c)):(j=this._getCaret(),f=j[0],d=j[1],this._replace(a+i+b,f,d),d=f+a.length+i.length+b.length,c||(f=d),this._setCaret(f,d)),this.textarea.scrollTop=g,this},a.prototype.insertBeforeLine=function(a,b){var c,d,e,f,g;return g=this.lineCaret(),d=g[0],c=g[1],f=this.lineText(),e=this.textarea.scrollTop,this._replace(a+f,d,c),c=d+a.length,b||(d=c),this._setCaret(d,c),this.textarea.scrollTop=e,this},a.prototype.insertAfterLine=function(a,b){var c,d,e,f,g;return g=this.lineCaret(),d=g[0],c=g[1],f=this.lineText(),e=this.textarea.scrollTop,this._replace(f+a,d,c),d=c,c+=a.length,b||(d=c),this._setCaret(d,c),this.textarea.scrollTop=e,this},a.prototype.encloseLine=function(a,b,c){var d,e,f,g,h,i,j;return i=this.lineText(),g=this.textarea.scrollTop,e=i.lastIndexOf(b),i.indexOf(a)===0&&e===i.length-b.length?(h=i.substring(a.length,i.length-b.length),this.text(h,c)):(j=this.lineCaret(),f=j[0],d=j[1],this._replace(a+i+b,f,d),d=f+a.length+i.length+b.length,c||(f=d),this._setCaret(f,d)),this.textarea.scrollTop=g,this},a}(),document.selection!=null&&(a=utils.Selection,b=function(a,b,c){var d,e,f;a+="",b+="";if(b.length<=0)return a.length+1;d=e=0,f=c?1:b.length;for(;;){e=a.indexOf(b,e);if(e>=0)d++,e+=f;else break}return d},utils.Selection=function(a){function c(a){this.textarea=a,this._document=this.textarea.ownerDocument}return d(c,a),c.prototype._getWholeText=function(){var a;return a=this.textarea.value,a=a.replace(/\r\n/g,"\n"),a},c.prototype._getCaret=function(){var a,c,d,e;return d=this._document.selection.createRange(),a=d.duplicate(),a.moveToElementText(this.textarea),a.setEndPoint("EndToEnd",d),e=a.text.length-d.text.length,c=e+d.text.length,c-=b(d.text,"\r\n"),[e,c]},c.prototype._setCaret=function(a,b){var c;return c=this.textarea.createTextRange(),c.collapse(!0),c.moveStart("character",a),c.moveEnd("character",b-a),c.select(),this},c}(a)),describe("femto.utils.Selection",function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;f=d=g=null,a=utils.Selection,before(function(){return f=document.createElement("textarea"),f.rollback=function(){return this.value="AAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"},f.rollback(),g=function(){return f.value.replace(/\r\n/g,"\n")},d=new a(f),document.body.appendChild(f),f.focus()}),afterEach(function(){return f.rollback()}),c=["_getCaret","_setCaret","_replace"],h=function(a){return it("instance should have private `"+a+"` method",function(){return expect(d).to.have.property(a),expect(d[a]).to.be.a("function")})};for(j=0,l=c.length;j<l;j++)e=c[j],h(e);b=["caret","text","lineCaret","lineText","insertBefore","insertAfter","enclose","insertBeforeLine","insertAfterLine","encloseLine"],i=function(a){return it("instance should have public `"+a+"` method",function(){return expect(d).to.have.property(a),expect(d[a]).to.be.a("function")})};for(k=0,m=b.length;k<m;k++)e=b[k],i(e);return describe("#caret(s, e) -> [s, e] | instance",function(){return it("should return current caret position as a list when called without any arguments",function(){var a;return d.caret(0,0),a=d.caret(),expect(a).to.be.a("array"),expect(a).to.be.eql([0,0])}),it("should return the instance when called with arguments",function(){var b;return b=d.caret(0,0),expect(b).to.be.a(a),expect(b).to.be.eql(d),b=d.caret(0),expect(b).to.be.a(a),expect(b).to.be.eql(d)}),it("should change caret position to specified when called with two arguments",function(){var a;return a=d.caret(1,2).caret(),expect(a).to.be.eql([1,2])}),it("should change caret position with specified offset when called with one argument",function(){var a,b;return b=d.caret(0,0).caret(),a=d.caret(5).caret(),expect(a).to.be.eql([b[0]+5,b[1]+5])})}),describe("#text(text, keepSelection) -> string | instance",function(){return it("should return current selected text when called without any arguments",function(){var a;return d.caret(0,0),a=d.text(),expect(a).to.be.a("string"),expect(a).to.be.eql(""),d.caret(5,26),a=d.text(),expect(a).to.be.eql("BBBBBCCCCC\naaaaabbbbb")}),it("should return the instance when called with arguments",function(){var b;return d.caret(0,0),b=d.text("HELLO"),expect(b).to.be.a(a),expect(b).to.be.eql(d),f.rollback(),b=d.text("HELLO",!0),expect(b).to.be.a(a),expect(b).to.be.eql(d)}),it("should insert text before the caret when no text is selected and called with one argument",function(){var a;return d.caret(0,0),a=d.text("HELLO"),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333")}),it("should insert text before the caret and select insertion when no text is selected and called with two arguments",function(){var a,b;return d.caret(0,0),b=d.text("HELLO",!0),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,5])}),it("should replace text of selected when text is selected and called with one argument",function(){var a;return d.caret(3,12),a=d.text("HELLO"),expect(g()).to.be.eql("AAAHELLOCCC\naaaaabbbbbccccc\n111112222233333")}),it("should replace text of selected and select replacement when text is selected and called with two arguments",function(){var a,b;return d.caret(3,12),b=d.text("HELLO",!0),expect(g()).to.be.eql("AAAHELLOCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([3,8])})}),describe("#lineCaret(s, e) -> [s, e]",function(){return it("should return current line caret position as a list when called without any arguments",function(){var a;return d.caret(5,26),a=d.lineCaret(),expect(a).to.be.a("array"),expect(a).to.be.eql([0,31])}),it("should return specified line caret position as a list when called with arguments",function(){var a;return d.caret(0,0),a=d.lineCaret(5,26),expect(a).to.be.a("array"),expect(a).to.be.eql([0,31]),expect(d.caret()).to.be.eql([0,0])})}),describe("#lineText(text, keepSelection) -> string | instance",function(){return it("should return current selected line text when called without any arguments",function(){var a;return d.caret(0,0),a=d.lineText(),expect(a).to.be.a("string"),expect(a).to.be.eql("AAAAABBBBBCCCCC"),d.caret(5,26),a=d.lineText(),expect(a).to.be.eql("AAAAABBBBBCCCCC\naaaaabbbbbccccc")}),it("should return the instance when called with arguments",function(){var b;return d.caret(0,0),b=d.lineText("HELLO"),expect(b).to.be.a(a),expect(b).to.be.eql(d),f.rollback(),b=d.lineText("HELLO",!0),expect(b).to.be.a(a),expect(b).to.be.eql(d)}),it("should replace single line of caret position when no text is selected and called with one argument",function(){var a;return d.caret(0,0),a=d.lineText("HELLO"),expect(g()).to.be.eql("HELLO\naaaaabbbbbccccc\n111112222233333")}),it("should replace single line of caret position and select insertion when no text is selected and called with two arguments",function(){var a,b;return d.caret(0,0),b=d.lineText("HELLO",!0),expect(g()).to.be.eql("HELLO\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,5])}),it("should replace lines of selection when text is selected and called with one argument",function(){var a;return d.caret(5,26),a=d.lineText("HELLO"),expect(g()).to.be.eql("HELLO\n111112222233333")}),it("should replace lines of selection and select replacement when text is selected and called with two arguments",function(){var a,b;return d.caret(5,26),b=d.lineText("HELLO",!0),expect(g()).to.be.eql("HELLO\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,5])})}),describe("#insertBefore(text, keepSelection) -> instance",function(){return it("should return the instance when called with arguments",function(){var b;return d.caret(0,0),b=d.insertBefore("HELLO"),expect(b).to.be.a(a),expect(b).to.be.eql(d),f.rollback(),b=d.insertBefore("HELLO",!0),expect(b).to.be.a(a),expect(b).to.be.eql(d)}),it("should insert text before the caret when no text is selected and called with one argument",function(){var a;return d.caret(0,0),a=d.insertBefore("HELLO"),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333")}),it("should insert text before the caret and select insertion when no text is selected and called with two arguments",function(){var a,b;return d.caret(0,0),b=d.insertBefore("HELLO",!0),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,5])}),it("should insert text before the selection when text is selected and called with one argument",function(){var a;return d.caret(0,5),a=d.insertBefore("HELLO"),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333")}),it("should insert text before the selection and select insertion when text is selected and called with two arguments",function(){var a,b;return d.caret(0,5),b=d.insertBefore("HELLO",!0),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,5])})}),describe("#insertAfter(text, keepSelection) -> instance",function(){return it("should return the instance when called with arguments",function(){var b;return d.caret(0,0),b=d.insertAfter("HELLO"),expect(b).to.be.a(a),expect(b).to.be.eql(d),f.rollback(),b=d.insertAfter("HELLO",!0),expect(b).to.be.a(a),expect(b).to.be.eql(d)}),it("should insert text after the caret when no text is selected and called with one argument",function(){var a;return d.caret(0,0),a=d.insertAfter("HELLO"),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333")}),it("should insert text after the caret and select insertion when no text is selected and called with two arguments",function(){var a,b;return d.caret(0,0),b=d.insertAfter("HELLO",!0),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,5])}),it("should insert text after the selection when text is selected and called with one argument",function(){var a;return d.caret(0,5),a=d.insertAfter("HELLO"),expect(g()).to.be.eql("AAAAAHELLOBBBBBCCCCC\naaaaabbbbbccccc\n111112222233333")}),it("should insert text after the selection and select insertion when text is selected and called with two arguments",function(){var a,b;return d.caret(0,5),b=d.insertAfter("HELLO",!0),expect(g()).to.be.eql("AAAAAHELLOBBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([5,10])})}),describe("#enclose(lhs, rhs, keepSelection) -> instance",function(){return it("should return the instance when called with arguments",function(){var b;return d.caret(0,0),b=d.enclose("HELLO","WORLD"),expect(b).to.be.a(a),expect(b).to.be.eql(d),f.rollback(),b=d.enclose("HELLO","WORLD",!0),expect(b).to.be.a(a),expect(b).to.be.eql(d)}),it("should insert both text before the caret when no text is selected and called with two arguments",function(){var a;return d.caret(0,0),a=d.enclose("HELLO","WORLD"),expect(g()).to.be.eql("HELLOWORLDAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333")}),it("should insert both text before the caret and select insertion when no text is selected and called with three arguments",function(){var a,b;return d.caret(0,0),b=d.enclose("HELLO","WORLD",!0),expect(g()).to.be.eql("HELLOWORLDAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,10])}),it("should enclose the selection with specified when text is selected and called with two arguments",function(){var a;return d.caret(0,5),a=d.enclose("HELLO","WORLD"),expect(g()).to.be.eql("HELLOAAAAAWORLDBBBBBCCCCC\naaaaabbbbbccccc\n111112222233333")}),it("should enclose the selection with specified and select text include insertion when text is selected and called with two arguments",function(){var a,b;return d.caret(0,5),b=d.enclose("HELLO","WORLD",!0),expect(g()).to.be.eql("HELLOAAAAAWORLDBBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,15])}),it("should remove specified when selected text (or caret) is enclosed and called with two arguments",function(){return d.caret(0,0),d.enclose("HELLO","WORLD",!0),d.enclose("HELLO","WORLD"),expect(g()).to.be.eql("AAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),d.caret(5,10),d.enclose("HELLO","WORLD",!0),d.enclose("HELLO","WORLD"),expect(g()).to.be.eql("AAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333")}),it("should remove specified and select text when selected text (or caret) is enclosed and called with three arguments",function(){var a;return d.caret(0,0),d.enclose("HELLO","WORLD",!0),d.enclose("HELLO","WORLD",!0),expect(g()).to.be.eql("AAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,0]),d.caret(5,10),d.enclose("HELLO","WORLD",!0),d.enclose("HELLO","WORLD",!0),expect(g()).to.be.eql("AAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([5,10])})}),describe("#insertBeforeLine(text, keepSelection) -> instance",function(){return it("should return the instance when called with arguments",function(){var b;return d.caret(0,0),b=d.insertBeforeLine("HELLO"),expect(b).to.be.a(a),expect(b).to.be.eql(d),f.rollback(),b=d.insertBeforeLine("HELLO",!0),expect(b).to.be.a(a),expect(b).to.be.eql(d)}),it("should insert text before the current line when no text is selected and called with one argument",function(){var a;return d.caret(0,0),a=d.insertBeforeLine("HELLO"),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333")}),it("should insert text before the current line and select insertion when no text is selected and called with two arguments",function(){var a,b;return d.caret(0,0),b=d.insertBeforeLine("HELLO",!0),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,5])}),it("should insert text before the line of the selection when text is selected and called with one argument",function(){var a;return d.caret(0,5),a=d.insertBeforeLine("HELLO"),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333")}),it("should insert text before the line of the selection and select insertion when text is selected and called with two arguments",function(){var a,b;return d.caret(0,5),b=d.insertBeforeLine("HELLO",!0),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,5])})}),describe("#insertAfterLine(text, keepSelection) -> instance",function(){return it("should return the instance when called with arguments",function(){var b;return d.caret(0,0),b=d.insertAfterLine("HELLO"),expect(b).to.be.a(a),expect(b).to.be.eql(d),f.rollback(),b=d.insertAfterLine("HELLO",!0),expect(b).to.be.a(a),expect(b).to.be.eql(d)}),it("should insert text after the current line when no text is selected and called with one argument",function(){var a;return d.caret(0,0),a=d.insertAfterLine("HELLO"),expect(g()).to.be.eql("AAAAABBBBBCCCCCHELLO\naaaaabbbbbccccc\n111112222233333")}),it("should insert text after the current line and select insertion when no text is selected and called with two arguments",function(){var a,b;return d.caret(0,0),b=d.insertAfterLine("HELLO",!0),expect(g()).to.be.eql("AAAAABBBBBCCCCCHELLO\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([15,20])}),it("should insert text after the line of the selection when text is selected and called with one argument",function(){var a;return d.caret(0,5),a=d.insertAfterLine("HELLO"),expect(g()).to.be.eql("AAAAABBBBBCCCCCHELLO\naaaaabbbbbccccc\n111112222233333")}),it("should insert text after the line of the selection and select insertion when text is selected and called with two arguments",function(){var a,b;return d.caret(0,5),b=d.insertAfterLine("HELLO",!0),expect(g()).to.be.eql("AAAAABBBBBCCCCCHELLO\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([15,20])})}),describe("#encloseLine(lhs, rhs, keepSelection) -> instance",function(){return it("should return the instance when called with arguments",function(){var b;return d.caret(0,0),b=d.encloseLine("HELLO","WORLD"),expect(b).to.be.a(a),expect(b).to.be.eql(d),f.rollback(),b=d.encloseLine("HELLO","WORLD",!0),expect(b).to.be.a(a),expect(b).to.be.eql(d)}),it("should insert both text before the current line when no text is selected and called with two arguments",function(){var a;return d.caret(0,0),a=d.encloseLine("HELLO","WORLD"),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCCWORLD\naaaaabbbbbccccc\n111112222233333")}),it("should insert both text before the current line and select insertion when no text is selected and called with three arguments",function(){var a,b;return d.caret(0,0),b=d.encloseLine("HELLO","WORLD",!0),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCCWORLD\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,25])}),it("should encloseLine the line of the selection with specified when text is selected and called with two arguments",function(){var a;return d.caret(0,5),a=d.encloseLine("HELLO","WORLD"),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCCWORLD\naaaaabbbbbccccc\n111112222233333")}),it("should encloseLine the line of the selection with specified and select text include insertion when text is selected and called with two arguments",function(){var a,b;return d.caret(0,5),b=d.encloseLine("HELLO","WORLD",!0),expect(g()).to.be.eql("HELLOAAAAABBBBBCCCCCWORLD\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,25])}),it("should remove specified when selected text (or caret) is encloseLined and called with two arguments",function(){return d.caret(0,0),d.encloseLine("HELLO","WORLD",!0),d.encloseLine("HELLO","WORLD"),expect(g()).to.be.eql("AAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),d.caret(5,10),d.encloseLine("HELLO","WORLD",!0),d.encloseLine("HELLO","WORLD"),expect(g()).to.be.eql("AAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333")}),it("should remove specified and select text when selected text (or caret) is encloseLined and called with three arguments",function(){var a;return d.caret(0,0),d.encloseLine("HELLO","WORLD",!0),d.encloseLine("HELLO","WORLD",!0),expect(g()).to.be.eql("AAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,15]),d.caret(5,10),d.encloseLine("HELLO","WORLD",!0),d.encloseLine("HELLO","WORLD",!0),expect(g()).to.be.eql("AAAAABBBBBCCCCC\naaaaabbbbbccccc\n111112222233333"),a=d.caret(),expect(a).to.be.eql([0,15])})})})})).call(this)